# Ruleset documentation
> How to write, edit, compile, and use a ruleset

If you wish to write your own ruleset or edit an existing ruleset, you can start by reading the [`Vanilla`](https://github.com/Aelto/tw3-a-gwent-empire/blob/master/compiler/Vanilla.ruleset) ruleset that comes pre-compiled with the mod.

### Variables
The syntax of a ruleset is relatively simple compared to what is generated by the compiler. It starts by storing the indices of the cards into variables, as the game recognizes the cards by their index (a number) it is often easier to declare a variable that points to the number so we can simply write `BlackArcher` instead of `235` later in the file.
Here is an example of how variables are declared:
```lua
variables {
  BlackArcher = 235,
  AnotherVariable = 100
}
```

### Factions
Once we've made our variables for easier writing, we can start declaring our factions. A faction is always composed of a group of leaders, a group of heroes and a group of units. During generation a deck is given a random leader, a random hero and multiple random units until all of its points are depleted.

A deck's quality is defined by two values: its `difficulty` and its `points`. The difficulty is what unlocks new cards, the higher it is the stronger the cards. The points controls how many cards the deck will have, in theory a deck with a high difficulty can have a low amount of points, resulting in strong cards in a limited amount.

Every time you define a card you can give it 3 additional values:
 - `count`: how many of them are available in the pool, higher count increases the chance for the card to be picked during generation

 - `cost`: the point cost of the card once it is picked

 - `difficulty`: the difficulty requirement for the card to appear, any player with a lower difficulty than what was entered won't get the card

the faction rules define what cards can be added to a deck during generation. They don't define the deck itself directly,
but the pool of cards to pick from while generating. Adding 10 Blue Stripe soldiers to the pool doesn't mean the decks
will have the 10 of them, but rather 10 of the pool are Blue Stripe solider. So if the pool consists of 400 cards,
then there is a 10/400 chance to pick a Blue Stripe soldier every time the generator asks a new card from the pool.

> Reminder 1: difficulty goes from 0 up to infinity where 10000 is already a really high difficulty
> 
> Reminder 2: points control how many cards can be in a deck as a player is given around 30 points (lower level players get less, higher players get more)
> and each card cost 1 point by default.

Here is an example of how a faction is declared:
```python
faction Skellige {
  leaders {
    1 King_bran_bronze,
    # available only if the player's difficulty is above 1000,
    # and if it is picked, it costs 2 points instead of 1
    1 King_bran_copper points(2) difficulty(1000)
  }

  heroes {
    1 CrachAnCraite,
    1 Hjalmar,
    1 Cock
  }

  units {
    1 Cerys difficulty(1000),
    1 Ermion difficulty(5000),
    1 Draig points(2),
    1 HolgerBlackhand,
    2 MadmanLugos,
    1 DonarAnHindar,
    1 Udalryk,

    2 Horn,
    # 2 more horns for higher difficulty opponents
    2 Horn points(2) difficulty(6000),

    1 Scorch points(2) difficulty(4000),
  }
}
```

### Compiling the ruleset
Once the ruleset is fully edited you can use the `age-compiler.exe` that is shipped with every release of the mod, drop it in the folder alongside the ruleset file and run the compiler (by double-clicking it). You should see a a mod folder being created, you can now install the mod folder by dropping it in your `The Witcher 3/mods` folder, then use the `agerulesetNameOfTheRuleset` command once in game where `NameOfTheRuleset` is the name of your ruleset file (excluding `.ruleset`)

### Advices for improved balance of ruleset
While filling the list of units you are able (and encouraged) to duplicate some entries for higher difficulties:
```python
  units {
    2 card_northern_francis points(2) difficulty(4000),
    1 card_northern_francis points(2) difficulty(6000),
    1 card_northern_whoreson points(2) difficulty(5000),
    1 card_northern_whoreson points(2) difficulty(9000),
  }
```

This allow a low level to have 2 entries for this card, and a high level one to have 5 of them. Thus giving a higher chance
of having this card in the generated deck.

It is very important you keep this technique in mind as you wouldn't want a high difficulty player to have a deck
full of low level cards. And since there is no way to exclude cards from the pool (yet) you must make sure higher
level players get new cards injected into the pool as a way to "drown out" the low level cards and ensure the
new higher level ones are picked more frequently.